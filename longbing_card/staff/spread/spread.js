var _xx_util=require("../../resource/js/xx_util.js"),_xx_util2=_interopRequireDefault(_xx_util),_index=require("../../resource/apis/index.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var app=getApp(),getAppGlobalData=require("../../templates/copyright/copyright.js");Page({data:{setCount:[{name:"今日"},{name:"近7天"},{name:"近30天"},{name:"本月"}],count:2,countList:{},globalData:{},staffInfo:{},staffCard:{},qrImg:""},onLoad:function(t){app.util.showLoading(1);var a=this;wx.hideShareMenu(),a.getStaffInfo(),a.getCardIndexData(),wx.hideLoading(),a.setData({globalData:app.globalData})},onReady:function(){},onShow:function(){this.toGetCount()},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){var t=this;wx.showNavigationBarLoading(),getApp().getConfigInfo(!0,!1).then(function(){t.setData({globalData:app.globalData},function(){wx.showNavigationBarLoading(),t.getStaffInfo(),t.getCardIndexData()})})},onReachBottom:function(){},onPageScroll:function(t){},onShareAppMessage:function(t){var a=this.data.cardIndexData;if("button"===t.from){var e=a.share_img;return e&&"cardType1"!=a.info.card_type&&"cardType4"!=a.info.card_type||(e=a.info.avatar_2),{title:a.info.share_text,path:"/longbing_card/pages/index/index?to_uid="+wx.getStorageSync("userid")+"&from_id="+wx.getStorageSync("userid")+"&currentTabBar=toCard",imageUrl:e}}},pickerSelected:function(t){var a=this;"count"==t.currentTarget.dataset.status&&(a.setData({count:t.detail.value}),a.setData({countList:{}}),a.toGetCount())},getStaffInfo:function(){var a=this;app.util.request({url:"entry/wxapp/Staff",cachetime:"30",method:"POST",data:{},success:function(t){t.data.errno||a.setData({staffInfo:t.data.data},function(){a.getStaffCard()})},fail:function(t){}})},getStaffCard:function(){var a=this;app.util.request({url:"entry/wxapp/StaffCard",cachetime:"30",method:"POST",data:{},success:function(t){t.data.errno||a.setData({StaffCard:t.data.data.count})},fail:function(t){}})},getCardIndexData:function(){var e=this;_xx_util2.default.showLoading();var t={to_uid:wx.getStorageSync("userid")};_index.userModel.getCardShow(t).then(function(t){_xx_util2.default.hideAll();var a=t.data;e.setData({cardIndexData:a})})},toGetCount:function(){var u=this;app.util.request({url:"entry/wxapp/extensionStatistics",cachetime:"30",method:"POST",data:{type:1*u.data.count+1},success:function(t){if(!t.data.errno){var a=t.data.data,e=((new app.util.date).dateToLong(new Date)/1e3).toFixed(0);if(a.extension.count||(a.extension.count=0),a.timeline.count||(a.timeline.count=0),a.card.count||(a.card.count=0),a.extension.last_time=parseInt(a.extension.last_time),a.extension.last_time){a.extension.last_time=e-a.extension.last_time;var n=parseInt(a.extension.last_time/86400),i=parseInt(a.extension.last_time/3600);a.extension.last_time=0<n?n+"天前互动":0<i?i+"小时前互动":""}else a.extension.last_time="";if(a.timeline.last_time=parseInt(a.timeline.last_time),a.timeline.last_time){a.timeline.last_time=e-a.timeline.last_time;var o=parseInt(a.timeline.last_time/86400),r=parseInt(a.timeline.last_time/3600);a.timeline.last_time=0<o?o+"天前互动":0<r?r+"小时前互动":""}else a.timeline.last_time="";if(a.card.last_time=parseInt(a.card.last_time),a.card.last_time){a.card.last_time=e-a.card.last_time;var s=parseInt(a.card.last_time/86400),d=parseInt(a.card.last_time/3600);a.card.last_time=0<s?s+"天前互动":0<d?d+"小时前互动":""}else a.card.last_time="";u.setData({countList:a})}},fail:function(t){}})},formSubmit:function(t){var a=t.detail.formId,e=t.detail.target.dataset.status,n=(t.detail.target.dataset.index,t.detail.target.dataset.type);this.toSaveFormIds(a),"toSpread"==e?"toProduct"==n?wx.navigateTo({url:"/longbing_card/staffs/pages/spread/product/product"}):"toNews"==n?wx.navigateTo({url:"/longbing_card/staffs/pages/spread/news/news?status=news"}):"toCard"==n||("toEwm"==n?wx.navigateTo({url:"/longbing_card/users/pages/card/share/share"}):"toCode"==n&&wx.navigateTo({url:"/longbing_card/staffs/pages/spread/news/news?status=code"})):"toHome"==e&&wx.reLaunch({url:"/longbing_card/pages/index/index?to_uid="+wx.getStorageSync("userid")+"&from_id="+wx.getStorageSync("userid")+"&currentTabBar=toCard"})},toSaveFormIds:function(t){app.util.request({url:"entry/wxapp/formid",cachetime:"30",method:"POST",data:{formId:t},success:function(t){t.data.errno},fail:function(t){}})},toJump:function(t){var a=t.currentTarget.dataset.status,e=t.currentTarget.dataset.type;"toCopyright"==a&&app.util.goUrl(t),(a="toSprdadDetail")&&3!=e&&wx.navigateTo({url:"/longbing_card/staffs/pages/spread/spread/spread?type="+e})}}); 
