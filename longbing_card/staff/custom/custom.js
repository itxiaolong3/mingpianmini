var _echarts=require("../../templates/ec-canvas/echarts"),echarts=_interopRequireWildcard(_echarts),_xx_util=require("../../resource/js/xx_util.js"),_xx_util2=_interopRequireDefault(_xx_util),_index=require("../../resource/apis/index.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _interopRequireWildcard(t){if(t&&t.__esModule)return t;var a={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(a[e]=t[e]);return a.default=t,a}function _toConsumableArray(t){if(Array.isArray(t)){for(var a=0,e=Array(t.length);a<t.length;a++)e[a]=t[a];return e}return Array.from(t)}var app=getApp(),getAppGlobalData=require("../../templates/copyright/copyright.js");Page({data:{globalData:{},Unchanged:[],avatarUrl:"",old:[],ec:{lazyLoad:!0},tabList:[{status:"toSetTab",type:"customer",name:"新增客户"},{status:"toSetTab",type:"follow",name:"跟进中"},{status:"toSetTab",type:"deal",name:"已成交"}],currentIndex:0,currentTabBar:"customer",lists:[],pages:1,total_page:"",typeindex:1,echartslist:[],echartsdata:[{value:"6",name:""},{value:"4",name:""},{value:"2",name:""}],Record:!1,Record_label:"0",Record_blur:"0",Record_input_value:"",Record_list:[],more:!0,loading:!1,show:!1,dataList:{page:1,total_page:"",list:[],refresh:!1,loading:!0}},onLoad:function(t){var a=this;app.util.showLoading(1),getAppGlobalData.getAppGlobalData(a,_index.baseModel,_xx_util2.default),wx.hideShareMenu(),app.util.request({url:"entry/wxapp/Staff",cachetime:"30",method:"POST",data:{},success:function(t){a.setData({job_id:t.data.data.info.job_id})}}),a.getTurnoverRateTotal(),wx.hideLoading()},onReady:function(){},onShow:function(){var t=this;t.setData({"dataList.page":1,"dataList.refresh":!0}),t.toGetClientList();var a=t.data.longType;if(a){for(var e in a)a[e]=0;t.setData({longType:a,touch_time:""})}},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){var t=this;t.setData({onPullDownRefresh:!0,"dataList.refresh":!0,"dataList.page":1},function(){t.toGetClientList(),t.getTurnoverRateTotal(),wx.showNavigationBarLoading()})},onReachBottom:function(){var t=this,a=t.data.dataList;a.page==a.total_page||a.loading||t.setData({"dataList.page":parseInt(a.page)+1,"dataList.loading":!0},function(){t.toGetClientList()})},onPageScroll:function(t){var a=this.data.longType;for(var e in a)a[e]=0;this.setData({longType:a})},onShareAppMessage:function(t){},getTurnoverRateTotal:function(){var s=this;app.util.request({url:"entry/wxapp/turnoverRateTotal",cachetime:"30",method:"POST",data:{},success:function(t){if(!t.data.errno){var a=t.data.data;1==s.data.onPullDownRefresh&&s.setData({echartslist:[],echartsdata:[]});var e=s.data.echartslist,r=[];r.push(a.deals),r.push(a.follows),r.push(a.users);var i=[];i.push(60),i.push(80),i.push(100);var o=["成交数量:","跟进数量:","总用户数:"];for(var n in o)e.push({name:o[n]+r[n],value:i[n]});s.setData({echartsdata:e,turnoverRateTotal:a}),s.barComponent=s.selectComponent("#mychart"),s.init_bar()}}})},searchclick:function(t){var a=wx.getStorageSync(this.data.job_id);a&&this.setData({old:a}),this.setData({Record:!0});var e=this;app.util.request({url:"entry/wxapp/oftenLabel",cachetime:"30",method:"POST",data:{},success:function(t){t.data.errno||e.setData({Unchanged:t.data.data})}})},searchover:function(t){this.setData({Record:!1,Record_label:"0",Record_blur:"0",Record_input_value:"",moreSearch:!0,isEmptySearch:!1,showSearch:!1})},Record_focuse:function(t){this.setData({Record_label:"1",Record_list:[]})},Record_blur:function(a){var t=this;if(a.detail.value){var e=t.data.old;if(e[0]){var r=!1;e.forEach(function(t){t==a.detail.value&&(r=!0)}),r||(e.length<3?e.push(a.detail.value):(e.push(a.detail.value),e=e.slice(-3)))}else e.push(a.detail.value);wx.setStorageSync(t.data.job_id,e),this.setData({Record_input_value:a.detail.value,Record_blur:"1",Record_label:"1",old:e});var i=a.detail.value;t.toGetSearchList(i)}else this.setData({Record_label:"0",Record_list:[]})},clickUnchanged:function(t){this.setData({Record_input_value:t.currentTarget.dataset.name,Record_blur:"1",Record_label:"1"});var a=t.currentTarget.dataset.name;this.toGetSearchList(a)},toGetSearchList:function(t){var r=this;app.util.request({url:"entry/wxapp/search",cachetime:"30",method:"POST",data:{type:"1",keyword:t},success:function(t){if(!t.data.errno){var a=t.data.data;if(0==a.length)return r.setData({moreSearch:!1,isEmptySearch:!0,showSearch:!0}),!1;var e=r.data.Record_list;e=a.data,r.setData({Record_list:e})}}})},init_bar:function(){var i=this;this.barComponent.init(function(t,a,e){var r=echarts.init(t,null,{width:a,height:e});return r.setOption(i.getBarOption()),r})},getBarOption:function(){return{legend:{data:this.data.echartslist,top:"10"},color:["#91c7ae","#d48265","#c23531"],calculable:!0,funnelAlign:"left",series:[{name:"漏斗图",type:"funnel",top:"50",bottom:"20",left:"20%",min:40,max:100,minSize:"40%",maxSize:"100%",width:"60%",sort:"descending",legendHoverLink:!0,gap:2,label:{normal:{show:!0,position:"inside"},emphasis:{textStyle:{fontSize:20}}},data:this.data.echartsdata.reverse()}]}},toGetClientList:function(){var o=this,t=o.data,n=t.dataList,a=t.currentIndex,e={page:n.page,type:1*a+1};n.refresh||_xx_util2.default.showLoading(),_index.bossModel.getClientList(e).then(function(t){_xx_util2.default.hideAll();var a=n,e=t.data;n.refresh||(e.list=[].concat(_toConsumableArray(a.list),_toConsumableArray(e.list)));var r=[];for(var i in e.list)r.push(0),e.list[i].last_time2=_xx_util2.default.ctDate(1*e.list[i].last_time),-1<e.list[i].share_str.indexOf("//XL:")&&(e.list[i].clientSourceStr=e.list[i].share_str.split("//XL:"),e.list[i].clientSourceType="group");e.page=e.page,e.refresh=!1,e.loading=!1,o.setData({dataList:e,longType:r})})},mytouchstart:function(t){var a=this,e=_xx_util2.default.getData(t),r=e.index,i=e.type,o=a.data.longType,n=void 0;for(var s in o)o[s]=0;0==i&&(o[r]=1,n=!0),setTimeout(function(){a.setData({longType:o,touch_type_time:n})},400),a.setData({touch_start:t.timeStamp})},mytouchend:function(t){this.setData({touch_end:t.timeStamp})},longTap:function(t){var a=_xx_util2.default.getData(t),e=a.index,r=a.type,i=this.data,o=i.touch_start,n=i.touch_end,s=i.longType,l=n-o,u=void 0;for(var d in s)s[d]=0;500<l?this.setData({longTypeInd:e}):(this.setData({longTypeInd:!1}),1==r?(s[e]=0,u=!1,this.setData({longType:s,touch_type_time:u})):_xx_util2.default.goUrl(t))},catchAddMark:function(t){_xx_util2.default.goUrl(t)},catchAddStar:function(){var e=this,t=e.data,r=t.longTypeInd,i=t.longType,o=t.dataList,a={client_id:o.list[r].id};_index.staffModel.getStarMark(a).then(function(t){for(var a in _xx_util2.default.hideAll(),i)i[a]=0;1==o.list[r].start?o.list[r].start=0:o.list[r].start=1,e.setData({dataList:o,longType:i,touch_time:!1,longTypeInd:!1})})},toJump:function(t){var a=_xx_util2.default.getData(t).status;"toCopyright"!=a&&"toJumpUrl"!=a||app.util.goUrl(t)},formSubmit:function(t){var a=this,e=t.detail.formId,r=_xx_util2.default.getFromData(t),i=r.status,o=r.type,n=r.index;"toSetTab"==i?a.setData({currentIndex:n,currentTabBar:o,"dataList.page":1,"dataList.refresh":!0,"dataList.loading":!0},function(){a.toGetClientList()}):"toHome"==i&&wx.reLaunch({url:"/longbing_card/pages/index/index?to_uid="+wx.getStorageSync("userid")+"&from_id="+wx.getStorageSync("userid")+"&currentTabBar=toCard"}),a.toSaveFormIds(e)},toSaveFormIds:function(t){app.util.request({url:"entry/wxapp/formid",cachetime:"30",method:"POST",data:{formId:t},success:function(t){t.data.errno}})}}); 
