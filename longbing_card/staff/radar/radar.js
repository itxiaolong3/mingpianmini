var _xx_util=require("../../resource/js/xx_util.js"),_xx_util2=_interopRequireDefault(_xx_util),_index=require("../../resource/apis/index.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _toConsumableArray(t){if(Array.isArray(t)){for(var a=0,e=Array(t.length);a<t.length;a++)e[a]=t[a];return e}return Array.from(t)}var app=getApp(),getAppGlobalData=require("../../templates/copyright/copyright.js");Page({data:{tabList:[{status:"time",name:"时间"},{status:"behavior",name:"行为"}],currentIndex:0,currentTab:"time",setCount:[{name:"近7天"},{name:"近30天"}],count:0,currentRadarTime:"",viewList:{page:1,total_page:"",list:[],refresh:!1,loading:!1},windowHeight:"",more:!0,loading:!1,isEmpty:!1,show:!1,authStatus:!0,radarTime:"",tmpDDDDDDataLength:0,behaviorInfo:[],behaviorList:[],globalData:{}},onLoad:function(t){var n=this;app.util.showLoading(1),wx.hideShareMenu(),getApp().getConfigInfo(!0,!1).then(function(){var t=app.globalData,a=t.platform,e=t.configInfo.config,i=e.android_pay,o=e.ios_pay,r=!0;-1<a.indexOf("android")&&0==i&&(r=!1),-1<a.indexOf("ios")&&0==o&&(r=!1),"time"==n.data.currentTab?n.toGetStaffView():"behavior"==n.data.currentTab&&(n.getRadarByBehaviorInfo(),n.getRadarByBehavior()),n.setData({windowHeight:wx.getSystemInfoSync().windowHeight,tmp_showPrice:r,globalData:app.globalData})}),wx.hideLoading()},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){var t=this;app.util.showLoading(1),getAppGlobalData.getAppGlobalData(t,_index.baseModel,_xx_util2.default),"time"==t.data.currentTab?t.setData({"viewList.refresh":!0,"viewList.page":1},function(){t.toGetStaffView()}):"behavior"==t.data.currentTab&&(t.setData({behaviorInfo:{},behaviorList:{}}),t.getRadarByBehaviorInfo(),t.getRadarByBehavior()),wx.showNavigationBarLoading(),wx.stopPullDownRefresh(),wx.hideLoading()},onReachBottom:function(){app.util.showLoading(1);var t=this,a=t.data,e=a.currentTab,i=a.viewList;"time"==e&&(i.page==i.total_page||i.loading||t.setData({"viewList.page":parseInt(i.page)+1,"viewList.loading":!1},function(){t.toGetStaffView()})),wx.hideLoading()},onPageScroll:function(t){},onShareAppMessage:function(t){},pickerSelected:function(t){var a=this;"count"==t.currentTarget.dataset.status&&a.setData({count:t.detail.value},function(){a.getRadarByBehaviorInfo()})},toGetStaffView:function(){var n=this,t=n.data,u=(t.staff_id,t.viewList),s=t.currentRadarTime,a={page:u.page};u.refresh||_xx_util2.default.showLoading(),_index.bossModel.getStaffView(a).then(function(t){_xx_util2.default.hideAll(),console.log("getStaffView ==>",t.data);var a=u,e=t.data;u.refresh||(e.list=[].concat(_toConsumableArray(a.list),_toConsumableArray(e.list)));var i=e.list,o=new app.util.date;for(var r in i)i[r].create_time&&(i[r].create_time1=o.dateToStr("YY/MM/DD",o.longToDate(1e3*i[r].create_time)),i[r].create_time2=o.dateToStr("HH:mm",o.longToDate(1e3*i[r].create_time))),"order"==i[r].sign&&(i[r].countText="，详情请查看订单中心并发货"),"praise"==i[r].sign&&2==i[r].type&&(1==i[r].count&&(i[r].countText="，TA正在了解你"),2!=i[r].count&&3!=i[r].count&&4!=i[r].count||(i[r].countText="，你成功的吸引了TA"),4<i[r].count&&(i[r].countText="，高意向客户立刻主动沟通")),"view"==i[r].sign&&(1==i[r].type&&(1==i[r].count&&(i[r].countText="，尽快把握商机"),2==i[r].count&&(i[r].countText="，潜在购买客户"),3==i[r].count&&(i[r].countText="，高意向客户成交在望"),3<i[r].count&&(i[r].countText="，购买欲望强烈")),3!=i[r].type&&6!=i[r].type||(2==i[r].count&&(i[r].countText="，赶快主动沟通"),2<i[r].count&&(i[r].countText="，高意向客户成交在望")),6==i[r].type&&1==i[r].count&&(i[r].countText="，看来TA对公司感兴趣")),s||(s=i[0].create_time1),s==i[r].create_time1&&(i[r].showTime=1),0<r&&(i[r].create_time1!=i[r-1].create_time1?(s=i[r].create_time1,i[r].showTime=1):i[r].showTime=0);n.setData({viewList:e,"viewList.page":u.page,"viewList.refresh":!1})})},getRadarByBehaviorInfo:function(){var a=this;app.util.request({url:"entry/wxapp/aiBehaviorHeader",cachetime:"30",method:"POST",data:{uniacid:app.siteInfo.uniacid,type:1*a.data.count+1},success:function(t){t.data.errno||a.setData({behaviorInfo:t.data.data})},fail:function(t){}})},getRadarByBehavior:function(){var a=this;app.util.request({url:"entry/wxapp/aiBehaviorOther",cachetime:"30",method:"POST",data:{type:1*a.data.count+1},success:function(t){t.data.errno||a.setData({behaviorList:t.data.data})},fail:function(t){}})},toJump:function(t){var a=t.currentTarget.dataset.status,e=t.currentTarget.dataset.index,i=t.currentTarget.dataset.id,o=this.data.viewList.list;if("toCopyright"==a&&app.util.goUrl(t),"toChat"==a){var r=o[e].user_id,n=o[e].user.nickName;n||(n="新客户");var u=app.globalData.avatarUrl,s=o[e].user.avatarUrl;s||(s=app.globalData.defaultUserImg);var c=o[e].phone;wx.navigateTo({url:"/longbing_card/chat/staffChat/staffChat?chat_to_uid="+r+"&contactUserName="+n+"&chatAvatarUrl="+u+"&toChatAvatarUrl="+s+"&clientPhone="+c})}else"toCustomInfo"==a&&wx.navigateTo({url:"/longbing_card/staffs/pages/custom/detail/detail?id="+i})},formSubmit:function(t){var a=this,e=t.detail.formId,i=t.detail.target.dataset.index,o=t.detail.target.dataset.status;a.toSaveFormIds(e),"toHome"!=o&&(a.setData({currentIndex:i,currentTab:o}),wx.pageScrollTo({duration:0,scrollTop:0})),"time"==o?(a.setData({"viewList.page":1,"viewList.refresh":!0}),a.toGetStaffView()):"behavior"==o?(a.getRadarByBehaviorInfo(),a.getRadarByBehavior()):"toHome"==o&&wx.reLaunch({url:"/longbing_card/pages/index/index?to_uid="+wx.getStorageSync("userid")+"&from_id="+wx.getStorageSync("userid")+"&currentTabBar=toCard"})},toSaveFormIds:function(t){app.util.request({url:"entry/wxapp/formid",cachetime:"30",method:"POST",data:{formId:t},success:function(t){t.data.errno},fail:function(t){}})}}); 
