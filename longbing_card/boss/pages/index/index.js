var _xx_util=require("../../../resource/js/xx_util.js"),_xx_util2=_interopRequireDefault(_xx_util),_index=require("../../../resource/apis/index.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _toConsumableArray(t){if(Array.isArray(t)){for(var a=0,e=Array(t.length);a<t.length;a++)e[a]=t[a];return e}return Array.from(t)}function _defineProperty(t,a,e){return a in t?Object.defineProperty(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e,t}var app=getApp(),echarts=require("../../../templates/ec-canvas/echarts");Page({data:_defineProperty({radarList:["1","2","3","4"],tabBarList:[{status:"toTabBar",type:"toOverview",name:"总览"},{status:"toTabBar",type:"toRank",name:"销售排行"},{status:"toTabBar",type:"toAnalysis",name:"AI分析"}],currentTabBar:"toOverview",tabList:[],tmp_Index:[{status:"toSetTab",name:"汇总"},{status:"toSetTab",name:"昨天"},{status:"toSetTab",name:"近7天"},{status:"toSetTab",name:"近30天"}],tmp_Rank:[{status:"toSetTab",name:"客户人数"},{status:"toSetTab",name:"订单量"},{status:"toSetTab",name:"互动频率"},{status:"toSetTab",name:"成交率区间"}],currentIndex:0,currentRank:0,is_more:1,setCount:["近7天","近15天","近30天"],count1:0,count2:0,count3:0,count4:0,setRank1:[],setRank2:[],tmp_rank1:["客户总数","新增客户"],tmp_rank2:["总跟进数","总成交数"],tmp_rank3:["昨天","近7天","近15天","近30天"],tmp_rank4:["1%-50%","50%-100%","全部"],rank1:[0,3],rank2:3,rank3:[0,3],rank4:2,nine:{new_client:0,view_client:0,mark_client:0,chat_client:0,sale_money:0,sale_order:0,share_count:0,save_count:0,thumbs_count:0},dataList:{page:1,total_page:"",total_count:"",list:[]},aiList:{page:1,total_page:"",total_count:"",list:[]},refresh:!1,refreshAI:!1,loading:!1,loadingAI:!1},"aiList",{com:{},list:[],max:{},page:1,total_page:""}),onLoad:function(t){_xx_util2.default.showLoading();var a=this;wx.hideShareMenu();var e=a.data,n=e.tmp_Index,o=e.tmp_Rank,r=e.tabList,i=e.currentTabBar,s=void 0;"toOverview"==i?(r=n,s="Boss雷达"):"toRank"==i?(r=o,s="销售排行"):"toAnalysis"==i&&(s="AI分析",a.toGetAI()),wx.setNavigationBarTitle({title:s}),getApp().getConfigInfo(!0,!1).then(function(){var t=wx.getStorageSync("userid");t&&(app.globalData.userid=t,app.globalData.to_uid=t),a.setData({globalData:app.globalData,tabList:r},function(){"toOverview"==a.data.currentTabBar&&a.toGetOverview()})})},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){var t=this,a=t.data,e=a.currentTabBar,n=a.currentRank;app.globalData.configInfo=!1,getApp().getConfigInfo(!0,!1).then(function(){t.setData({globalData:app.globalData},function(){"toOverview"==e?t.setData({is_more:1},function(){wx.showNavigationBarLoading(),t.toGetOverview()}):"toRank"==e?t.setData({refresh:!0,"dataList.page":1},function(){wx.showNavigationBarLoading(),0==n?t.toGetRankClients():1==n?t.toGetRankOrder():2==n?t.toGetRankInteraction():3==n&&t.toGetRankRate()}):"toAnalysis"==e&&t.setData({refreshAI:!0,"aiList.page":1},function(){t.toGetAI()})})})},onReachBottom:function(){var t=this,a=t.data,e=a.loading,n=a.currentTabBar,o=a.currentRank;if("toOverview"==n);else if("toRank"==n){var r=t.data.dataList,i=r.page;i==r.total_page||e||t.setData({"dataList.page":parseInt(i)+1,loading:!1},function(){0==o?t.toGetRankClients():1==o?t.toGetRankOrder():2==o?t.toGetRankInteraction():3==o&&t.toGetRankRate()})}else if("toAnalysis"==n){var s=t.data.loadingAI,l=t.data.aiList,u=l.page;u==l.total_page||s||t.setData({"aiList.page":parseInt(u)+1,loadingAI:!1},function(){t.toGetAI()})}},onShareAppMessage:function(){},toGetOverview:function(){var _=this,t=_.data,m=t.is_more,a=t.currentIndex,e={is_more:m,type:a};1==m&&_xx_util2.default.showLoading(),_index.bossModel.getOverview(e).then(function(t){if(_xx_util2.default.hideAll(),0==m){var a=t.data.nine;for(var e in a)a[e]||(a[e]=0);_.setData({nine:a})}if(1==m){var n=t.data,o=n.nine,r=n.dealRate,i=n.orderMoney,s=n.newClient,l=n.askClient,u=n.markClient,d=n.interest,c=n.activity,p=n.activityBarGraph,f=[{data:r,type:1},{data:i,type:2},{data:s,type:3},{data:l,type:4},{data:u,type:5},{data:d,type:6},{data:c,type:7},{data:p,type:8}];for(var g in o)o[g]||(o[g]=0);_.setData({nine:o,dealRate:r,orderMoney:i,newClient:s,askClient:l,markClient:u,interest:d,activity:c,activityBarGraph:p,tmpCountData:f},function(){for(var t in f)_.init_echart(f[t].data,f[t].type)})}})},toGetRankClients:function(){var n=this,t=n.data,a=t.rank1,o=t.refresh,r=t.dataList,e={page:r.page,sign:1*a[0]+1,type:1*a[1]+1};o||_xx_util2.default.showLoading(),_index.bossModel.getRankClients(e).then(function(t){_xx_util2.default.hideAll();var a=r,e=t.data;o||(e.list=[].concat(_toConsumableArray(a.list),_toConsumableArray(e.list))),n.setData({dataList:e,refresh:!1,loading:!1})})},toGetRankOrder:function(){var n=this,t=n.data,a=t.rank2,o=t.refresh,r=t.dataList,e={page:r.page,type:1*a+1};_index.bossModel.getRankOrder(e).then(function(t){_xx_util2.default.hideAll();var a=r,e=t.data;o||(e.list=[].concat(_toConsumableArray(a.list),_toConsumableArray(e.list))),n.setData({dataList:e,refresh:!1,loading:!1})})},toGetRankInteraction:function(){var n=this,t=n.data,a=t.rank3,o=t.refresh,r=t.dataList,e={page:r.page,sign:1*a[0]+1,type:1*a[1]+1};_index.bossModel.getRankInteraction(e).then(function(t){_xx_util2.default.hideAll();var a=r,e=t.data;o||(e.list=[].concat(_toConsumableArray(a.list),_toConsumableArray(e.list))),n.setData({dataList:e,refresh:!1,loading:!1})})},toGetRankRate:function(){var n=this,t=n.data,a=t.rank4,o=t.refresh,r=t.dataList,e={page:r.page,type:1*a+1};_index.bossModel.getRankRate(e).then(function(t){_xx_util2.default.hideAll();var a=r,e=t.data;o||(e.list=[].concat(_toConsumableArray(a.list),_toConsumableArray(e.list))),n.setData({dataList:e,refresh:!1,loading:!1})})},toGetAI:function(){var o=this,t=o.data,r=t.refreshAI,i=t.aiList,a=(t.radarList,{page:i.page});r||_xx_util2.default.showLoading(),_index.bossModel.getAi(a).then(function(t){_xx_util2.default.hideAll();var a=i,e=e,n=t.data;r||(n.com=[].concat(_toConsumableArray(a.com),_toConsumableArray(n.com)),n.list=[].concat(_toConsumableArray(a.list),_toConsumableArray(n.list)),n.max=[].concat(_toConsumableArray(a.max),_toConsumableArray(n.max))),e=n.list,o.setData({radarList:e,aiList:n,refreshAI:!1,"aiList.page":i.page},function(){var t=o.data.aiList.list;for(var a in t)o.init_echart(t[a].value_2,9+1*a)})})},pickerSelected:function(t){var a=this,e=_xx_util2.default.getData(t).status,n=t.detail.value,o=a.data,r=o.rank1,i=o.rank2,s=o.rank3,l=o.rank4,u=o.currentRank;0==u?("toRank1"==e&&(r[0]=n),"toRank2"==e&&(r[1]=n),a.setData({rank1:r,dataList:{page:1,total_page:"",total_count:"",list:[]}},function(){a.toGetRankClients()})):1==u?"toRank3"==e&&(i=n,a.setData({rank2:i,dataList:{page:1,total_page:"",total_count:"",list:[]}},function(){a.toGetRankOrder()})):2==u?("toRank1"==e&&(s[0]=n),"toRank2"==e&&(s[1]=n),a.setData({rank3:s,dataList:{page:1,total_page:"",total_count:"",list:[]}},function(){a.toGetRankInteraction()})):3==u&&"toRank3"==e&&(l=n,a.setData({rank4:l,dataList:{page:1,total_page:"",total_count:"",list:[]}},function(){a.toGetRankRate()}))},init_echart:function(o,r){var i=this;i.selectComponent("#mychart"+r).init(function(t,a,e){var n=echarts.init(t,null,{width:a,height:e});return 1==r?n.setOption(i.getFunnelOption(o)):6==r?n.setOption(i.getPieOption(o,r)):8==r?n.setOption(i.getCategoryOption(o,r)):9<=r?n.setOption(i.getRadarOption(o,r)):n.setOption(i.getLineOption(o,r)),n})},getFunnelOption:function(t){return{legend:{data:["总用户数"+t.client,"跟进数量"+t.mark_client,"成交数量"+t.deal_client],bottom:"0"},color:["#91c7ae","#d48265","#c23531"],calculable:!0,funnelAlign:"left",series:[{name:"漏斗图",type:"funnel",top:"10",bottom:"45",left:"20%",min:40,max:100,minSize:"40%",maxSize:"100%",width:"60%",sort:"descending",legendHoverLink:!0,gap:2,label:{normal:{show:!0,position:"inside"},emphasis:{textStyle:{fontSize:16}}},data:[{value:100,name:"总用户数"+t.client},{value:80,name:"跟进数量"+t.mark_client},{value:60,name:"成交数量"+t.deal_client}]}]}},getPieOption:function(t){return{legend:{bottom:0,left:"center",data:[]},color:["#91c7ae","#d48265","#c23531"],series:[{name:"访问来源",type:"pie",radius:["60%","80%"],center:["50%","60%"],data:[{value:t.compony.number,name:t.compony.rate+"%"},{value:t.staff.number,name:t.staff.rate+"%"},{value:t.goods.number,name:t.goods.rate+"%"}]}]}},getCategoryOption:function(t){var a=[],e=[];for(var n in t)a.push(t[n].title),e.push(t[n].number);return{tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},color:["#91c7ae"],legend:{data:[""]},grid:{top:20,left:"3%",right:"5%",bottom:"3%",containLabel:!0},xAxis:{type:"value",boundaryGap:[0,.01]},yAxis:[{type:"category",data:a,axisLabel:{interval:0,rotate:0},splitLine:{show:!1}}],series:[{type:"bar",label:{normal:{position:"right",show:!0}},data:e}]}},getRadarOption:function(t,a){var e=[],n=[],o=this.data.aiList.max,r=50;for(var i in 9==a&&(r=80),10!=a&&11!=a||(r=65),t)9<a?e.push({text:"",max:parseFloat(o[i])}):e.push({text:t[i].titlle+t[i].value,max:parseFloat(o[i])}),n.push(parseFloat(t[i].value));return{legend:{x:"center",data:[""]},radar:[{indicator:e,center:["50%","50%"],radius:r}],series:[{type:"radar",tooltip:{trigger:"item"},itemStyle:{normal:{areaStyle:{type:"default"}}},data:[{value:n}]}]}},getLineOption:function(t,a){var e=[],n=[],o=[],r=[];for(var i in t)e.push(t[i].date),2==a?(n.push(t[i].order_number),o.push(t[i].money_number)):r.push(t[i].number);return 2==a?{legend:{data:["商城订单量","交易金额"]},color:["#1774dc","#e93636"],grid:{top:"40",left:"3%",right:"5%",bottom:"10",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:e}],yAxis:[{type:"value"}],series:[{name:"商城订单量",type:"line",stack:"",areaStyle:{},data:n},{name:"交易金额",type:"line",stack:"",areaStyle:{},data:o}]}:{legend:{data:[]},color:["#1774dc"],grid:{top:"10",left:"3%",right:"5%",bottom:"10",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:e}],yAxis:[{type:"value"}],series:[{name:"",type:"line",stack:"",areaStyle:{},data:r}]}},toJump:function(t){var a=this,e=_xx_util2.default.getData(t),n=e.status,o=e.index,r=e.type,i=e.avatar,s=a.data,l=s.orderMoney,u=s.newClient,d=s.askClient,c=s.markClient,p=[],f=void 0,g=a.data,_=g.rank1,m=g.rank2,k=g.rank3,v=g.rank4,h=g.currentRank;if("toChangeRank"==n)a.setData({refresh:!0,"dataList.page":1}),0==h?("toRank1"==r&&(_[0]=o),"toRank2"==r&&(_[1]=o),a.setData({rank1:_},function(){a.toGetRankClients()})):1==h?"toRank1"==r&&(m=o,a.setData({rank2:m},function(){a.toGetRankOrder()})):2==h?("toRank1"==r&&(k[0]=o),"toRank2"==r&&(k[1]=o),a.setData({rank3:k},function(){a.toGetRankInteraction()})):3==h&&"toRank1"==r&&(v=o,a.setData({rank4:v},function(){a.toGetRankRate()}));else if("toCount1"==n||"toCount2"==n||"toCount3"==n||"toCount4"==n){0==o?f=23:1==o?f=15:2==o&&(f=0),"toCount1"==n&&a.setData({count1:o}),"toCount2"==n&&a.setData({count2:o}),"toCount3"==n&&a.setData({count3:o}),"toCount4"==n&&a.setData({count4:o});for(var y=f;y<30;y++)2==r&&p.push(l[y]),3==r&&p.push(u[y]),4==r&&p.push(d[y]),5==r&&p.push(c[y]);a.init_echart(p,r)}else if("toJumpUrl"==n)if("currStaff"==r){var x=a.data.aiList.list[o];x.rank=1*o+1,a.setData({staff_ai_data:x},function(){_xx_util2.default.goUrl(t)})}else"toAvatar"==r&&wx.setStorageSync("toAvatar",i),_xx_util2.default.goUrl(t)},formSubmit:function(t){var e=this,a=t.detail.formId,n=_xx_util2.default.getFromData(t),o=n.status,r=n.index,i=n.type,s=e.data.currentTabBar;if("toSetTab"==o){if("toOverview"==s)e.setData({currentIndex:r,is_more:0},function(){e.toGetOverview()});else if("toRank"==s){var l=e.data,u=l.setRank1,d=l.setRank2,c=l.tmp_rank1,p=l.tmp_rank2,f=l.tmp_rank3,g=l.tmp_rank4;0==r?u=[c,f]:1==r?d=f:2==r?u=[p,f]:3==r&&(d=g),e.setData({currentRank:r,setRank1:u,setRank2:d,refresh:!0,"dataList.page":1},function(){var t=e.data.currentRank;0==t&&e.toGetRankClients(),1==t&&e.toGetRankOrder(),2==t&&e.toGetRankInteraction(),3==t&&e.toGetRankRate()})}}else if("toTabBar"==o){var _=e.data,m=_.is_more,k=_.tmp_Index,v=_.tmp_Rank,h=_.tabList,y=_.currentTabBar,x=void 0;if(x="Boss雷达","toOverview"==(y=i)&&(h=k,m=0,e.setData({tabList:h,is_more:m,currentTabBar:y},function(){if("toOverview"==e.data.currentTabBar){var t=e.data.tmpCountData;if(t)for(var a in t)e.init_echart(t[a].data,t[a].type);else e.setData({is_more:1},function(){e.toGetOverview()})}})),"toRank"==i){x="销售排行";var b=e.data,R=b.setRank1,A=b.setRank2,L=b.tmp_rank1,C=b.tmp_rank2,D=b.tmp_rank3,G=b.tmp_rank4,w=b.currentRank;0==w?R=[L,D]:1==w?A=D:2==w?R=[C,D]:1==w&&(A=G),h=v,e.setData({currentTabBar:y,tabList:h,setRank1:R,setRank2:A,refresh:!0,"dataList.page":1},function(){0==w?e.toGetRankClients():1==w?e.toGetRankOrder():2==w?e.toGetRankInteraction():3==w&&e.toGetRankRate()})}else"toAnalysis"==y&&(x="AI分析",e.setData({currentTabBar:y,refreshAI:!0,"aiList.page":1},function(){e.toGetAI()}));wx.setNavigationBarTitle({title:x})}else"toJumpUrl"==o&&_xx_util2.default.goUrl(t,!0);e.toSaveFormIds(a)},toSaveFormIds:function(t){var a={formId:t};_index.bossModel.getFormId(a).then(function(t){_xx_util2.default.hideAll()})}}); 
