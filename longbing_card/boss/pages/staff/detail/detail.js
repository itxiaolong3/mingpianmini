var _xx_util=require("../../../../resource/js/xx_util.js"),_xx_util2=_interopRequireDefault(_xx_util),_index=require("../../../../resource/apis/index.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}var app=getApp(),echarts=require("../../../../templates/ec-canvas/echarts");Page({data:{tabList:[{status:"toSetTab",name:"雷达能力图"},{status:"toSetTab",name:"数据分析"},{status:"toSetTab",name:"客户互动"},{status:"toSetTab",name:"TA的跟进"}],currentIndex:0,setCount:["汇总","昨天","近7天","近30天"],count:0,is_more:1,currentRadarTime:"",viewList:{page:1,total_page:"",list:[],refresh:!1,loading:!1},followList:{page:1,total_page:"",list:[],refresh:!1,loading:!1},nine:{new_client:0,view_client:0,mark_client:0,chat_client:0,sale_money:0,sale_order:0,share_count:0,save_count:0,thumbs_count:0}},onLoad:function(t){var r=this;console.log(t,"options"),wx.hideShareMenu();var l=t.id;getApp().getConfigInfo(!0,!1).then(function(){var t=app.globalData,e=t.platform,a=t.configInfo.config,i=a.android_pay,n=a.ios_pay,o=!0;-1<e.indexOf("android")&&0==i&&(o=!1),-1<e.indexOf("ios")&&0==n&&(o=!1),r.setData({tmp_showPrice:o,globalData:app.globalData,staff_id:l},function(){r.getCardIndexData(),r.toGetStaffNumber();var t=getCurrentPages(),e=t[t.length-2].__viewData__,a=e.staff_ai_data,i=e.aiList.max,n=a.info.name;n||(n=a.nickName),wx.setNavigationBarTitle({title:n+"员工"}),r.setData({staff_ai_data:a,max:i},function(){r.init_echart(a.value_2,1)})})})},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){var t=this,e=t.data.currentIndex;app.globalData.configInfo=!1,getApp().getConfigInfo(!0,!1).then(function(){t.setData({globalData:app.globalData},function(){wx.showNavigationBarLoading(),0==e?t.toGetStaffNumber():1==e?t.setData({is_more:1},function(){t.toGetStaffEchart()}):2==e?t.setData({"viewList.refresh":!0,"viewList.page":1},function(){t.toGetStaffView()}):3==e&&t.setData({"followList.refresh":!0,"followList.page":1},function(){t.toGetStaffFollow()})})})},onReachBottom:function(){var t=this,e=t.data,a=e.currentIndex,i=e.viewList,n=e.followList;2==a?i.page==i.total_page||i.loading||t.setData({"viewList.page":parseInt(i.page)+1,"viewList.loading":!1},function(){t.toGetStaffView()}):3==a&&(n.page==n.total_page||n.loading||t.setData({"followList.page":parseInt(n.page)+1,"followList.loading":!1},function(){t.toGetStaffFollow()}))},onPageScroll:function(t){},onShareAppMessage:function(t){},getCardIndexData:function(){var a=this;_xx_util2.default.showLoading();var t={to_uid:a.data.staff_id};_index.userModel.getCardShow(t).then(function(t){_xx_util2.default.hideAll();var e=t.data;a.setData({cardIndexData:e})})},toGetStaffNumber:function(){var a=this,t={staff_id:a.data.staff_id};_index.bossModel.getStaffNumber(t).then(function(t){_xx_util2.default.hideAll();var e=t.data;a.setData({staff_info:e})})},toGetStaffEchart:function(){var c=this,t=c.data,e=t.staff_id,d=t.is_more,a=t.count,i={is_more:d,type:a,staff_id:e};1==d&&_xx_util2.default.showLoading(),_index.bossModel.getStaffEchart(i).then(function(t){if(_xx_util2.default.hideAll(),0==d){var e=t.data.nine;for(var a in e)e[a]||(e[a]=0);c.setData({nine:e})}if(1==d){var i=t.data,n=i.nine,o=i.dealRate,r=i.interest,l=i.activity,s=i.activityBarGraph,u=[{data:o,type:2},{data:r,type:3},{data:l,type:4},{data:s,type:5}];for(var f in n)n[f]||(n[f]=0);c.setData({nine:n,dealRate:o,interest:r,activity:l,activityBarGraph:s,tmpCountData:u},function(){for(var t in u)c.init_echart(u[t].data,u[t].type)})}})},toGetStaffView:function(){var r=this,t=r.data,e=t.staff_id,l=t.viewList,s=t.currentRadarTime,a={page:l.page,staff_id:e};l.refresh||_xx_util2.default.showLoading(),_index.bossModel.getStaffView(a).then(function(t){_xx_util2.default.hideAll();var e=l,a=t.data;l.refresh||(a.list=[].concat(_toConsumableArray(e.list),_toConsumableArray(a.list)));var i=a.list,n=new app.util.date;for(var o in i)i[o].create_time&&(i[o].create_time1=n.dateToStr("YY/MM/DD",n.longToDate(1e3*i[o].create_time)),i[o].create_time2=n.dateToStr("HH:mm",n.longToDate(1e3*i[o].create_time))),"order"==i[o].sign&&(i[o].countText="，详情请查看订单中心并发货"),"praise"==i[o].sign&&2==i[o].type&&(1==i[o].count&&(i[o].countText="，TA正在了解你"),2!=i[o].count&&3!=i[o].count&&4!=i[o].count||(i[o].countText="，你成功的吸引了TA"),4<i[o].count&&(i[o].countText="，高意向客户立刻主动沟通")),"view"==i[o].sign&&(1==i[o].type&&(1==i[o].count&&(i[o].countText="，尽快把握商机"),2==i[o].count&&(i[o].countText="，潜在购买客户"),3==i[o].count&&(i[o].countText="，高意向客户成交在望"),3<i[o].count&&(i[o].countText="，购买欲望强烈")),3!=i[o].type&&6!=i[o].type||(2==i[o].count&&(i[o].countText="，赶快主动沟通"),2<i[o].count&&(i[o].countText="，高意向客户成交在望")),6==i[o].type&&1==i[o].count&&(i[o].countText="，看来TA对公司感兴趣")),s||(s=i[0].create_time1),s==i[o].create_time1&&(i[o].showTime=1),0<o&&(i[o].create_time1!=i[o-1].create_time1?(s=i[o].create_time1,i[o].showTime=1):i[o].showTime=0);r.setData({viewList:a,"viewList.page":l.page,"viewList.refresh":!1})})},toGetStaffFollow:function(){var r=this,t=r.data,e=t.staff_id,l=t.followList,s=t.currentRadarTime,a={page:l.page,staff_id:e};l.refresh||_xx_util2.default.showLoading(),_index.bossModel.getStaffFollow(a).then(function(t){_xx_util2.default.hideAll();var e=l,a=t.data;l.refresh||(a.list=[].concat(_toConsumableArray(e.list),_toConsumableArray(a.list)));var i=a.list,n=new app.util.date;for(var o in i)i[o].create_time&&(i[o].create_time1=n.dateToStr("YY/MM/DD",n.longToDate(1e3*i[o].create_time)),i[o].create_time2=n.dateToStr("HH:mm",n.longToDate(1e3*i[o].create_time))),"praise"==i[o].sign&&2==i[o].type&&(1==i[o].count&&(i[o].countText="，TA正在了解你"),2!=i[o].count&&3!=i[o].count&&4!=i[o].count||(i[o].countText="，你成功的吸引了TA"),4<i[o].count&&(i[o].countText="，高意向客户立刻主动沟通")),"view"==i[o].sign&&(1==i[o].type&&(1==i[o].count&&(i[o].countText="，尽快把握商机"),2==i[o].count&&(i[o].countText="，潜在购买客户"),3==i[o].count&&(i[o].countText="，高意向客户成交在望"),3<i[o].count&&(i[o].countText="，购买欲望强烈")),3!=i[o].type&&6!=i[o].type||(2==i[o].count&&(i[o].countText="，赶快主动沟通"),2<i[o].count&&(i[o].countText="，高意向客户成交在望")),6==i[o].type&&1==i[o].count&&(i[o].countText="，看来TA对公司感兴趣")),s||(s=i[0].create_time1),s==i[o].create_time1&&(i[o].showTime=1),0<o&&(i[o].create_time1!=i[o-1].create_time1?(s=i[o].create_time1,i[o].showTime=1):i[o].showTime=0);r.setData({followList:a,"followList.page":l.page,"followList.refresh":!1})})},init_echart:function(n,o){var r=this;r.selectComponent("#mychart"+o).init(function(t,e,a){var i=echarts.init(t,null,{width:e,height:a});return 1==o?i.setOption(r.geRadarOption(n)):2==o?i.setOption(r.getFunnelOption(n)):3==o?i.setOption(r.getPieOption(n,o)):4==o?i.setOption(r.getLineOption(n,o)):5==o&&i.setOption(r.getCategoryOption(n,o)),i})},getFunnelOption:function(t){return{legend:{data:["总用户数"+t.client,"跟进数量"+t.mark_client,"成交数量"+t.deal_client],bottom:"0"},color:["#91c7ae","#d48265","#c23531"],calculable:!0,funnelAlign:"left",series:[{name:"漏斗图",type:"funnel",top:"10",bottom:"45",left:"20%",min:40,max:100,minSize:"40%",maxSize:"100%",width:"60%",sort:"descending",legendHoverLink:!0,gap:2,label:{normal:{show:!0,position:"inside"},emphasis:{textStyle:{fontSize:16}}},data:[{value:100,name:"总用户数"+t.client},{value:80,name:"跟进数量"+t.mark_client},{value:60,name:"成交数量"+t.deal_client}]}]}},getPieOption:function(t){return{legend:{bottom:0,left:"center",data:[]},color:["#91c7ae","#d48265","#c23531"],series:[{name:"访问来源",type:"pie",radius:["60%","80%"],center:["50%","60%"],data:[{value:t.compony.number,name:t.compony.rate+"%"},{value:t.staff.number,name:t.staff.rate+"%"},{value:t.goods.number,name:t.goods.rate+"%"}]}]}},getCategoryOption:function(t){var e=[],a=[];for(var i in t)e.push(t[i].title),a.push(t[i].number);return{tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},color:["#91c7ae"],legend:{data:[""]},grid:{top:20,left:"3%",right:"5%",bottom:"3%",containLabel:!0},xAxis:{type:"value",boundaryGap:[0,.01]},yAxis:[{type:"category",data:e,axisLabel:{interval:0,rotate:0},splitLine:{show:!1}}],series:[{type:"bar",label:{normal:{position:"right",show:!0}},data:a}]}},geRadarOption:function(t){var e=[],a=[],i=this.data.max;for(var n in t)e.push({text:t[n].titlle+t[n].value,max:parseFloat(i[n])}),a.push(parseFloat(t[n].value));return{legend:{x:"center",data:[""]},radar:[{indicator:e,center:["50%","50%"],radius:80}],series:[{type:"radar",tooltip:{trigger:"item"},itemStyle:{normal:{areaStyle:{type:"default"}}},data:[{value:a}]}]}},getLineOption:function(t){var e=[],a=[];for(var i in t)e.push(t[i].date),a.push(t[i].number);return{legend:{data:[]},color:["#1774dc"],grid:{top:"10",left:"3%",right:"5%",bottom:"10",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:e}],yAxis:[{type:"value"}],series:[{name:"",type:"line",stack:"",areaStyle:{},data:a}]}},toJump:function(t){var e=this,a=_xx_util2.default.getData(t),i=a.status,n=a.index,o=a.type;if("toJumpUrl"==i)if("toCusDetail"==o){var r=e.data.staff_ai_data.avatarUrl;r||(r=app.globalData.defaultUserImg),app.globalData.avatarUrlStaff=r,_xx_util2.default.goUrl(t)}else _xx_util2.default.goUrl(t);else"toCount"==i&&e.setData({count:n,is_more:0},function(){e.toGetStaffEchart()})},formSubmit:function(t){var i=this,e=t.detail.formId,a=_xx_util2.default.getFromData(t),n=a.status,o=a.index;a.type;"toSetTab"==n&&i.setData({currentIndex:o},function(){if(0==o){var t=i.data.staff_ai_data;i.init_echart(t.value_2,1)}else if(1==o){var e=i.data.tmpCountData;if(e)for(var a in e)i.init_echart(e[a].data,e[a].type);else i.setData({is_more:1},function(){i.toGetStaffEchart()})}else 2==o?i.setData({"viewList.page":1,"viewList.refresh":!0},function(){i.toGetStaffView()}):3==o&&i.setData({"followList.page":1,"followList.refresh":!0},function(){i.toGetStaffFollow()})}),i.toSaveFormIds(e)},toSaveFormIds:function(t){var e={formId:t};_index.bossModel.getFormId(e).then(function(t){_xx_util2.default.hideAll()})}}); 
