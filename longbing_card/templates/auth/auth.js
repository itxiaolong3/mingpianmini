var _that=void 0,_baseModel=void 0,_util=void 0;function checkAuth(t,a,e){_that=t,_baseModel=a,_util=e,wx.getSetting({success:function(t){t.authSetting["scope.userInfo"]?(console.log("有res.authSetting['scope.userInfo']"),getApp().globalData.auth.authStatus=!0,_that.setData({"globalData.auth.authStatus":!0},function(){var t=_that.data.globalData.configInfo.config.exchange_switch,a=_that.data,e=a.currentTabBar,o=a.cardIndexData;if("cardList"==e||"toCard"==e){if(1==t){var n=o.to_uid,h=wx.getStorageSync("isShowCard");h||(h=[]);var u=void 0;-1<h.indexOf(n)||n==wx.getStorageSync("userid")?u=!1:(u=!0,h.push(n),wx.setStorageSync("isShowCard",h)),_that.setData({isToShowCard:u})}}else toCheckAuthStatus()}),wx.getUserInfo({lang:"zh_CN",success:function(t){getChangeUserInfo(t.userInfo)}})):(console.log("没有res.authSetting['scope.userInfo']"),getApp().globalData.auth.authStatus=!1,_that.setData({"globalData.auth.authStatus":!1}))},fail:function(t){console.log("wx.getSetting ==>> fail")}})}function toCheckAuthStatus(){var t=!0;getApp().globalData.configInfo.config&&1==getApp().globalData.configInfo.config.force_phone&&0==getApp().globalData.hasClientPhone&&(t=!1),getApp().globalData.auth.authStatus=!0,getApp().globalData.auth.authPhoneStatus=t,_that.setData({"globalData.auth.authStatus":!0,"globalData.auth.authPhoneStatus":t}),console.log(_that.data.globalData.auth)}function getUserInfo(t){if(t.detail.userInfo){var a=t.detail.userInfo;console.log("获取微信用户信息 ==>>",a),getChangeUserInfo(a),getApp().globalData.auth.authStatus=!0,_that.setData({"globalData.auth.authStatus":!0},function(){var t=_that.data.globalData.configInfo.config.exchange_switch,a=_that.data,e=a.currentTabBar,o=a.cardIndexData;if("toCard"==e){if(1==t){var n=o.to_uid,h=wx.getStorageSync("isShowCard");h||(h=[]);var u=void 0;-1<h.indexOf(n)||n==wx.getStorageSync("userid")?u=!1:(u=!0,h.push(n),wx.setStorageSync("isShowCard",h)),_that.setData({isToShowCard:u})}}else toCheckAuthStatus()})}else console.log("拒绝授权"),_that.setData({authStatus:!1})}function getChangeUserInfo(e){var t=e;console.log("_baseModel.getUpdateUserInfo"),_baseModel.getUpdateUserInfo(t).then(function(t){_util.hideAll();var a=wx.getStorageSync("user");a.nickName=e.nickName,a.avatarUrl=e.avatarUrl,wx.setStorageSync("user",a)})}function getAuthPhoneNumber(t){if("getPhoneNumber:ok"==t.detail.errMsg){if(console.log("同意授权获取电话号码"),setPhoneInfo(t.detail.encryptedData,t.detail.iv),console.log(_that.data.cardIndexData,"_that.data.cardIndexData"),_that.data.cardIndexData){var a=_that.data.cardIndexData.info,e=a.avatar,o=a.name,n=a.phone,h=a.telephone,u=a.wechat,s=a.email,l=a.myCompany;wx.addPhoneContact({photoFilePath:e,firstName:o,mobilePhoneNumber:n,hostNumber:h,weChatNumber:u,email:s,organization:l.name,workAddressCity:l.addr,success:function(t){if(getApp().globalData.to_uid!=wx.getStorageSync("userid")){var a={type:1,to_uid:getApp().globalData.to_uid};_baseModel.getCopyRecord(a).then(function(t){util.hideAll()})}}})}}else"getPhoneNumber:fail user deny"==t.detail.errMsg&&console.log("拒绝授权获取电话号码")}function setPhoneInfo(t,a){var e={encryptedData:t,iv:a,to_uid:getApp().globalData.to_uid};_baseModel.getPhone(e).then(function(t){_util.hideAll();var a=t.data;if(a){var e=wx.getStorageSync("user");e.phone=a.phone,wx.setStorageSync("user",e)}getApp().globalData.hasClientPhone=!0,getApp().globalData.auth.authPhoneStatus=!0,_that.setData({"globalData.hasClientPhone":!0,"globalData.auth.authPhoneStatus":!0})})}module.exports={checkAuth:checkAuth,getUserInfo:getUserInfo,getAuthPhoneNumber:getAuthPhoneNumber};