var _xx_util=require("../../../../resource/js/xx_util.js"),_xx_util2=_interopRequireDefault(_xx_util),_index=require("../../../../resource/apis/index.js");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var app=getApp(),getAppGlobalData=require("../../../../templates/copyright/copyright.js");Page({data:{type:"",dataList:[],globalData:{},tmpMore:[],page:1,more:!0,loading:!1,isEmpty:!1,show:!1},onLoad:function(a){var t=this;app.util.showLoading(1),wx.hideShareMenu(),a.type&&(t.setData({type:a.type}),1==a.type?wx.setNavigationBarTitle({title:"产品推广"}):2==a.type?wx.setNavigationBarTitle({title:"动态推广"}):3==a.type&&(wx.setNavigationBarTitle({title:"名片推广"}),t.getCardIndexData())),t.getListData(),wx.hideLoading()},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){app.util.showLoading(1);var a=this;wx.showNavigationBarLoading(),getAppGlobalData.getAppGlobalData(a,_index.baseModel,_xx_util2.default),a.setData({dataList:[],page:1,more:!0,loading:!1,isEmpty:!1,show:!1}),a.getListData(),wx.stopPullDownRefresh(),wx.hideLoading()},onReachBottom:function(){app.util.showLoading(1);var a=this;a.setData({show:!0}),0==a.data.isEmpty&&(a.setData({page:a.data.page+1}),a.getListData()),wx.hideLoading()},onPageScroll:function(a){},onShareAppMessage:function(a){},getCardIndexData:function(){var e=this;_xx_util2.default.showLoading();var a={to_uid:wx.getStorageSync("userid")};_index.userModel.getCardShow(a).then(function(a){_xx_util2.default.hideAll(),console.log("getCardShow ==>",a.data);var t=a.data;e.setData({cardIndexData:t})})},getListData:function(){var l=this;app.util.request({url:"entry/wxapp/extensionDetailV2",cachetime:"30",method:"POST",data:{page:l.data.page,type:l.data.type},success:function(a){if(console.log("extensionDetailV2 ==>",a),!a.data.errno){var t=a.data.data.list;if(0==t.length)return l.setData({more:!1,loading:!1,isEmpty:!0,show:!0}),!1;l.setData({loading:!0});var e=l.data.dataList,i=((new app.util.date).dateToLong(new Date)/1e3).toFixed(0);for(var o in t){for(var r in t[o].cover)t[o].cover[r]||t[o].cover.splice(r,1);for(var n in t[o].groups)if(t[o].groups[n].update_time=parseInt(t[o].groups[n].update_time),t[o].groups[n].update_time){t[o].groups[n].update_time=i-t[o].groups[n].update_time;var s=parseInt(t[o].groups[n].update_time/86400),d=parseInt(t[o].groups[n].update_time/3600);t[o].groups[n].update_time=0<s?s+"天前互动":0<d?d+"小时前互动":""}else t[o].groups[n].update_time="";e.push(t[o])}l.setData({dataList:e});var p=l.data.dataList,u=[];for(var g in p)u.push("0");l.setData({tmpMore:u})}},fail:function(a){}})},toJump:function(a){var t=a.currentTarget.dataset.status,e=a.currentTarget.dataset.id,i=a.currentTarget.dataset.opengid;"toCopyright"==t&&app.util.goUrl(a),"toShopDetail"==t?wx.navigateTo({url:"/longbing_card/pages/shop/detail/detail?id="+e}):"toNewsDetail"==t?wx.navigateTo({url:"/longbing_card/users/pages/news/detail/detail?id="+e+"&to_uid="+wx.getStorageSync("userid")+"&from_id="+wx.getStorageSync("userid")}):"toCodeDetail"==t?0==e?wx.navigateTo({url:"/longbing_card/users/pages/card/share/share"}):wx.navigateTo({url:"/longbing_card/staffs/pages/spread/code/code?id="+e+"&name="+this.data.cardIndexData.info.name+"&avatar="+this.data.cardIndexData.info.avatar}):"toSpreadDetail"==t&&wx.navigateTo({url:"/longbing_card/staffs/pages/spread/detail/detail?id="+e+"&opengid="+i})}}); 
