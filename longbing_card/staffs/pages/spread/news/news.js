var _xx_util=require("../../../../resource/js/xx_util.js"),_xx_util2=_interopRequireDefault(_xx_util),_index=require("../../../../resource/apis/index.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var app=getApp(),getAppGlobalData=require("../../../../templates/copyright/copyright.js");Page({data:{status:"",name:"",avatar:"",globalData:{},dataList:[],page:1,more:!0,loading:!1,isEmpty:!1,show:!1},onLoad:function(t){app.util.showLoading(1),console.log(t,"options"),t.status&&(this.setData({status:t.status,globalData:app.globalData}),"news"==t.status?(wx.setNavigationBarTitle({title:"动态推广"}),wx.showShareMenu({withShareTicket:!0,success:function(t){},fail:function(t){}})):"code"==t.status&&(wx.setNavigationBarTitle({title:"自定义码推广"}),this.getCardIndexData())),wx.hideShareMenu(),wx.hideLoading()},onReady:function(){},onShow:function(){app.util.showLoading(1);var t=this;t.setData({page:1,dataList:[]}),"news"==t.data.status?t.getNewsListData():"code"==t.data.status&&t.getCodeListData(),wx.hideLoading()},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){app.util.showLoading(1);var t=this;wx.showNavigationBarLoading(),getAppGlobalData.getAppGlobalData(t,_index.baseModel,_xx_util2.default),t.setData({dataList:[],page:1,more:!0,loading:!1,isEmpty:!1,show:!1}),"news"==t.data.status?t.getNewsListData():"code"==t.data.status&&t.getCodeListData(),wx.stopPullDownRefresh(),wx.hideLoading()},onReachBottom:function(){app.util.showLoading(1);var t=this;t.setData({show:!0}),0==t.data.isEmpty&&(t.setData({page:t.data.page+1}),"news"==t.data.status?t.getNewsListData():"code"==t.data.status&&t.getCodeListData()),wx.hideLoading()},onPageScroll:function(t){},onShareAppMessage:function(t){if("button"===t.from&&"news"==this.data.status){var a=t.target.dataset.index,e=t.target.dataset.id,i=this.data.dataList;return console.log(i[a].title,i[a].cover[0]),{title:i[a].title,path:"/longbing_card/users/pages/news/detail/detail?to_uid="+wx.getStorageSync("userid")+"&from_id="+wx.getStorageSync("userid")+"&id="+e+"&type=3",imageUrl:i[a].cover[0]}}},getNewsListData:function(){var n=this;app.util.request({url:"entry/wxapp/myTimeline",cachetime:"30",method:"POST",data:{page:n.data.page},success:function(t){if(console.log("myTimeline ==>",t),!t.data.errno){var a=t.data.data.list;if(0==a.length)return n.setData({more:!1,loading:!1,isEmpty:!0,show:!0}),!1;var e=n.data.dataList,i=new app.util.date;for(var o in a){for(var s in a[o].create_time.length<12&&(a[o].create_time=i.dateToStr("yyyy/MM/DD",i.longToDate(1e3*a[o].create_time))),a[o].cover)a[o].cover[s]||(console.log("null      ****",s),a[o].cover.splice(s,1));e.push(a[o])}n.setData({dataList:e,loading:!0})}},fail:function(t){}})},getCodeListData:function(){var s=this;app.util.request({url:"entry/wxapp/releaseQrList",cachetime:"30",method:"POST",data:{page:s.data.page},success:function(t){if(console.log("releaseQrList ==>",t),!t.data.errno){var a=t.data.data.list;if(0==a.length)return s.setData({more:!1,loading:!1,isEmpty:!0,show:!0}),!1;var e=s.data.dataList,i=new app.util.date;for(var o in a)a[o].create_time.length<12&&(a[o].create_time=i.dateToStr("yyyy/MM/DD",i.longToDate(1e3*a[o].create_time))),e.push(a[o]);s.setData({dataList:e,loading:!0})}},fail:function(t){}})},getCardIndexData:function(){var e=this;_xx_util2.default.showLoading();var t={to_uid:wx.getStorageSync("userid")};_index.userModel.getCardShow(t).then(function(t){_xx_util2.default.hideAll(),console.log("getCardShow ==>",t.data);var a=t.data;e.setData({cardIndexData:a})})},toDeleteQr:function(a){var e=this,i=e.data.dataList;app.util.request({url:"entry/wxapp/DeleteQr",cachetime:"30",method:"POST",data:{id:i[a].id},success:function(t){console.log("DeleteQr ==>",t),t.data.errno||(wx.showToast({icon:"none",title:"自定义码删除成功！",duration:1e3}),i.splice(a,1),e.setData({dataList:i}))},fail:function(t){}})},toDeleteTimeline:function(a){var e=this,i=e.data.dataList;app.util.request({url:"entry/wxapp/DeleteTimeline",cachetime:"30",method:"POST",data:{id:i[a].id},success:function(t){console.log("DeleteTimeline ==>",t),t.data.errno||(wx.showToast({icon:"none",title:"动态删除成功！",duration:1e3}),i.splice(a,1),e.setData({dataList:i}))},fail:function(t){}})},toJump:function(t){var a=t.currentTarget.dataset.status,e=t.currentTarget.dataset.id;"toCopyright"==a||"toAddNews"==a?app.util.goUrl(t):"toNewsDetail"==a&&(console.log("跳转至详情"),"news"==this.data.status?wx.navigateTo({url:"/longbing_card/users/pages/news/detail/detail?id="+e+"&to_uid="+wx.getStorageSync("userid")+"&from_id="+wx.getStorageSync("userid")}):"code"==this.data.status&&wx.navigateTo({url:"/longbing_card/staffs/pages/spread/code/code?id="+e}))},formSubmit:function(t){var a=this,e=t.detail.formId,i=t.detail.target.dataset.index,o=t.detail.target.dataset.status;a.toSaveFormIds(e),"toShare"==o||("toDelete"==o?wx.showModal({title:"",content:"是否确认删除此数据？",success:function(t){t.confirm&&("news"==a.data.status?a.toDeleteTimeline(i):"code"==a.data.status&&a.toDeleteQr(i))}}):"toCodeDetial"==o&&wx.navigateTo({url:"/longbing_card/staffs/pages/spread/code/code?id="+a.data.dataList[i].id+"&name="+a.data.name+"&avatar="+a.data.avatar}))},toSaveFormIds:function(t){app.util.request({url:"entry/wxapp/formid",cachetime:"30",method:"POST",data:{formId:t},success:function(t){t.data.errno},fail:function(t){console.log("fail ==> ",t)}})}}); 
