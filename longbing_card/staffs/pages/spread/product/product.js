var _xx_util=require("../../../../resource/js/xx_util.js"),_xx_util2=_interopRequireDefault(_xx_util),_index=require("../../../../resource/apis/index.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var app=getApp(),getAppGlobalData=require("../../../../templates/copyright/copyright.js");Page({data:{globalData:{},dataList:[],page:1,more:!0,loading:!1,isEmpty:!1,show:!1},onLoad:function(t){app.util.showLoading(1);var s=this;wx.showShareMenu({withShareTicket:!0,success:function(t){},fail:function(t){}}),getApp().getConfigInfo(!0,!1).then(function(){var t=app.globalData,a=t.platform,e=t.configInfo.config,o=e.android_pay,i=e.ios_pay,n=!0;-1<a.indexOf("android")&&0==o&&(n=!1),-1<a.indexOf("ios")&&0==i&&(n=!1),s.setData({globalData:app.globalData,tmp_showPrice:n},function(){s.getListData()})}),wx.hideLoading()},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){app.util.showLoading(1);var t=this;wx.showNavigationBarLoading(),getAppGlobalData.getAppGlobalData(t,_index.baseModel,_xx_util2.default),t.setData({onPullDownRefresh:!0,page:1,more:!0,loading:!1,isEmpty:!1,show:!1}),t.getListData(),wx.stopPullDownRefresh(),wx.hideLoading()},onReachBottom:function(){app.util.showLoading(1);var t=this;t.setData({show:!0}),0==t.data.isEmpty&&(t.setData({page:t.data.page+1}),t.getListData()),wx.hideLoading()},onPageScroll:function(t){},onShareAppMessage:function(t){if("button"===t.from){var a=t.target.dataset.index,e=this.data.dataList;return{title:e[a].name,path:"/longbing_card/pages/shop/detail/detail?to_uid="+wx.getStorageSync("userid")+"&from_id="+wx.getStorageSync("userid")+"&id="+e[a].id+"&type=2&nickName="+app.globalData.nickName,imageUrl:e[a].cover}}},getListData:function(){var n=this;app.util.request({url:"entry/wxapp/extensions",cachetime:"30",method:"POST",data:{page:n.data.page},success:function(t){if(console.log("extensions ==>",t),!t.data.errno){var a=t.data.data.list;if(0==a.length)return n.setData({more:!1,loading:!1,isEmpty:!0,show:!0}),!1;var e=n.data.dataList;for(var o in 1==n.data.onPullDownRefresh&&(e=[]),a)e.push(a[o]);for(var i in e)e[i].shop_price=(e[i].price/1e4).toFixed(2);n.setData({dataList:e,onPullDownRefresh:!1,loading:!0})}},fail:function(t){}})},toSetExtension:function(a){var e=this,o=e.data.dataList;app.util.request({url:"entry/wxapp/extension",cachetime:"30",method:"POST",data:{goods_id:o[a].id},success:function(t){console.log("extension ==>",t),t.data.errno||(0==o[a].is_extension?o[a].is_extension=1:1==o[a].is_extension&&(o[a].is_extension=0),e.setData({dataList:o}))},fail:function(t){}})},formSubmit:function(t){var a=this,e=t.detail.formId,o=_xx_util2.default.getFromData(t),i=o.status,n=o.index,s=o.ids;if(a.toSaveFormIds(e),"toPush"==i)a.toSetExtension(n);else if("toAddMyShop"==i||"toDelMyShop"==i){"toAddMyShop"==i?_index.staffModel.toAddMyShop({ids:s}):"toDelMyShop"==i&&_index.staffModel.toDelMyShop({ids:s});var d=a.data.dataList;0==d[n].is_my_shop?d[n].is_my_shop=1:1==d[n].is_my_shop&&(d[n].is_my_shop=0),a.setData({dataList:d})}},toSaveFormIds:function(t){app.util.request({url:"entry/wxapp/formid",cachetime:"30",method:"POST",data:{formId:t},success:function(t){t.data.errno},fail:function(t){console.log("fail ==> ",t)}})},toJump:function(t){var a=t.currentTarget.dataset.status,e=t.currentTarget.dataset.id;"toCopyright"==a&&app.util.goUrl(t),"toShopDetail"==a&&wx.navigateTo({url:"/longbing_card/pages/shop/detail/detail?id="+e})}}); 
