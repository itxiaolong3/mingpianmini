var _xx_util=require("../../../../resource/js/xx_util.js"),_xx_util2=_interopRequireDefault(_xx_util),_index=require("../../../../resource/apis/index.js"),_xx_request=require("../../../../resource/js/xx_request.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _toConsumableArray(t){if(Array.isArray(t)){for(var a=0,e=Array(t.length);a<t.length;a++)e[a]=t[a];return e}return Array.from(t)}var app=getApp(),voucher=require("../../../../templates/voucher/voucher.js");Page({data:{currPage:"voulist",tabList:[{status:"toSetTab",name:"待使用"},{status:"toSetTab",name:"已使用"},{status:"toSetTab",name:"已过期"}],currentIndex:0,voucherStatus:{show:!1,status:"unreceive"},dataList:{page:1,total_page:"",list:[],refresh:!1,loading:!0},checkvou:[]},onLoad:function(t){var a=this;console.log(t,"options"),wx.hideShareMenu();var e={},o={};t.status&&(e.status=t.status,e.check=t.check,o.to_uid=t.to_uid,o.money=t.money),getApp().getConfigInfo(!0,!1).then(function(){a.setData({globalData:app.globalData,paramObj:e,couponObj:o},function(){"checkvou"==e.status?a.toGetSouponshop():a.toGetCouponList()})})},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){var t=this;app.globalData.configInfo=!1,getApp().getConfigInfo(!0,!1).then(function(){t.setData({globalData:app.globalData},function(){t.setData({"dataList.page":1,"dataList.refresh":!0},function(){wx.showNavigationBarLoading(),"checkvou"==t.data.paramObj.status?t.toGetSouponshop():t.toGetCouponList()})})})},onReachBottom:function(){var t=this;if("checkvou"!=t.data.paramObj.status){var a=t.data.dataList;a.page==a.total_page||a.loading||t.setData({"dataList.page":parseInt(a.page)+1,"dataList.loading":!1},function(){t.toGetCouponList()})}},onShareAppMessage:function(){},toGetCouponList:function(){var o=this,t=o.data,a=t.currentIndex,n=t.dataList,e=(t.checkvou,{page:parseInt(n.page),type:a});(!n.refresh||0<=a)&&_xx_util2.default.showLoading(),_index.userModel.getCouponList(e).then(function(t){_xx_util2.default.hideAll(),console.log("getCouponList ==>",t.data);var a=n,e=t.data;n.refresh||(e.list=[].concat(_toConsumableArray(a.list),_toConsumableArray(e.list))),e.refresh=!1,e.loading=!1,o.setData({dataList:e})})},toGetSouponshop:function(){var u=this,t=u.data,a=t.couponObj,s=t.checkvou,r=t.dataList;r.refresh||_xx_util2.default.showLoading(),_index.userModel.getSouponshop(a).then(function(t){_xx_util2.default.hideAll(),console.log("getSouponshop ==>",t.data);var a=r,e=t.data;r.refresh||(e.list=[].concat(_toConsumableArray(a.list),_toConsumableArray(e.list))),e.refresh=!1,e.loading=!1;var o=u.data.paramObj;if("checkvou"==o.status)for(var n in e.list)s.push(0),o.check&&(s[o.check]=1);u.setData({dataList:e,checkvou:s})})},toGetCouponQr:function(t){var o=this,a={record_id:t};_index.userModel.getCouponQr(a).then(function(t){_xx_util2.default.hideAll(),console.log("getCouponQr ==>",t.data);var a=t.data.path,e="unreceive";1==o.data.currentIndex&&(e="receive"),o.setData({tmp_qr:a,"voucherStatus.show":!0,"voucherStatus.status":e})})},toCloseVoucher:function(){voucher.toCloseVoucher(this)},toJump:function(t){var a=this,e=_xx_util2.default.getData(t),o=e.status,n=e.index,u=a.data,s=u.currentIndex,r=u.dataList,i=u.checkvou,c=u.paramObj,l=r.list[n],d=l.id,h=l.type,f=r.list[n];if("toUseVoucher"==o&&0==s)if(1==h)if("checkvou"==c.status){if(0==i[n]){for(var p in i)i[p]=0;i[n]=1}else 1==i[n]&&(i[n]=0);a.setData({checkvou:i},function(){1==i[n]&&(app.globalData.checkvoucher=f,app.globalData.checkvoucher.checkvoucher=n,wx.navigateBack())})}else _xx_util2.default.goUrl(t);else 2==h&&a.setData({currentVoucher:f},function(){a.toGetCouponQr(d)})},formSubmit:function(t){var a=this,e=t.detail.formId,o=_xx_util2.default.getFromData(t),n=o.index;"toSetTab"==o.status&&a.setData({currentIndex:n,"dataList.list":[],"dataList.refresh":!0},function(){a.toGetCouponList()}),a.toSaveFormIds(e)},toSaveFormIds:function(t){var a={formId:t};_index.baseModel.getFormId(a).then(function(t){})}}); 
