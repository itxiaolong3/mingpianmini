var _xx_util=require("../../../../resource/js/xx_util.js"),_xx_util2=_interopRequireDefault(_xx_util),_index=require("../../../../resource/apis/index.js");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var timerLeftTime,app=getApp();Page({data:{globalData:{},bgStatus:!1,shareStatus:!1},onLoad:function(a){var t=this;console.log(a,"options"),app.util.showLoading(1),wx.hideShareMenu();var e={};a.id&&(e.detailID=a.id),a.collage_id&&(e.collage_id=a.collage_id),a.to_uid&&(e.to_uid=a.to_uid,app.globalData.to_uid=a.to_uid),a.from_id&&(e.from_id=a.from_id,app.globalData.from_id=a.from_id),a.status&&(e.status=a.status),a.sharestatus&&(e.sharestatus=a.sharestatus),getApp().getConfigInfo(!0,!1).then(function(){t.setData({paramData:e,globalData:app.globalData},function(){t.getProductDetail(),wx.hideLoading()})})},onReady:function(){},onShow:function(){},onHide:function(){clearInterval(timerLeftTime)},onUnload:function(){clearInterval(timerLeftTime)},onPullDownRefresh:function(){wx.showNavigationBarLoading(),this.getProductDetail()},onReachBottom:function(){},onShareAppMessage:function(a){var t=this,e=t.data.paramData;return a.from,{title:t.data.detailData.name,path:"/longbing_card/users/pages/shop/releaseCollage/releaseCollage?id="+e.detailID+"&collage_id="+e.collage_id+"&to_uid="+e.to_uid+"&from_id="+wx.getStorageSync("userid")+"&status=toPay&sharestatus=fromshare",imageUrl:t.data.detailData.cover_true}},getProductDetail:function(){var o=this;console.log(o.data.paramData.to_uid,"app.globalData.to_uid");var a={goods_id:o.data.paramData.detailID,to_uid:o.data.paramData.to_uid};_index.userModel.getShopGoodsDetail(a).then(function(a){var t=a.data,e={name:t.name,collage_count:t.collage_count,cover2:t.cover2,qr:t.qr};o.setData({shareParamObj:e,detailData:t},function(){o.getCollageList()})})},getCollageList:function(){var c=this,a={goods_id:c.data.paramData.detailID};_index.userModel.getShopCollageList(a).then(function(a){var t,e=a.data,o=(new app.util.date,{});for(var r in e)c.data.paramData.collage_id==e[r].id&&(o=e[r]);e=o,console.log(e,"////////////////////////****tmpData");var i=e.left_time;timerLeftTime=setInterval(function(){i-=1;var a=parseInt(i/24/60/60);t=(a=0<a?a+"å¤© ":"")+_xx_util2.default.formatTime(1e3*i,"h:m:s"),c.setData({tmpTimes:t})},1e3);var s=[];if(e.users)for(var l in e.users)s.push(e.users[l].id);for(var d in e.own&&s.push(e.own.id),console.log(s,"************///"),s)wx.getStorageSync("userid")==s[d]&&c.setData({"paramData.status":"toShare"});console.log(e,"//////////////////******collageList");var n=e,u={price:n.price,people:n.people};c.setData({shareParamObj2:u,collageList:e})})},toJump:function(a){var t=this,e=a.currentTarget.dataset.status;if("toCopyright"==e||"toJumpIndex"==e)app.util.goUrl(a);else if("toShare"==e)t.setData({bgStatus:!0,shareStatus:!0});else if("toCheckShare"==e){var o=a.currentTarget.dataset.num;1==o||2==o&&wx.navigateTo({url:"/longbing_card/users/pages/shop/collageShare/collageShare"}),t.setData({bgStatus:!1,shareStatus:!1})}else if("toJoinCollage"==e){var r=t.data.collageList,i=t.data.detailData;for(var s in i.spe_price)r.spe_price_id==i.spe_price[s].id&&(i.stock=i.spe_price[s].stock);t.setData({detailData:i});var l={count_price:r.number*r.price,tmp_trolley_ids:i.id,dataList:[{name:i.name,number:r.number,goods_id:i.id,cover_true:i.cover_true,freight:i.freight,spe:t.data.spe_text,price2:r.price,stock:i.stock,collage_id:r.id}]};wx.setStorageSync("storageToOrder",l);var d="/longbing_card/users/pages/shop/car/toOrder/toOrder?status="+e;"fromshare"==t.data.paramData.sharestatus&&(d+="&sharestatus=fromshare"),console.log("dddddddddddddd",d),wx.redirectTo({url:d})}}}); 
