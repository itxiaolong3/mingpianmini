var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_xx_util=require("../../../../../resource/js/xx_util.js"),_xx_util2=_interopRequireDefault(_xx_util),_index=require("../../../../../resource/apis/index.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var app=getApp();Page({data:{},onLoad:function(t){wx.hideShareMenu(),console.log(t,"options");var e=app.util.url("entry/wxapp/upload"),a=getCurrentPages();a.length&&(a=a[getCurrentPages().length-1])&&a.__route__&&(e=e+"&m="+a.__route__.split("/")[0]);var o={};t.title&&(o.title=t.title,null!=_typeof(o.title)&&"undefined"!=o.title&&o.title||(o.title="")),t.tmpPath&&(o.tmpPath=t.tmpPath),t.tmpImg&&(o.tmpImg=t.tmpImg),this.setData({paramObj:o,uploadUrl:e,globalData:app.globalData})},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){},toGetSavePoster:function(){var t=this.data.paramObj,e={title:t.title,img:t.tmpImg};_index.userModel.getSavePoster(e).then(function(t){_xx_util2.default.hideAll(),t.data.img&&(_xx_util2.default.showSuccess("海报上传成功"),setTimeout(function(){wx.navigateBack()},500))})},chooseImage:function(){var i=this;wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){var e=t.tempFilePaths[0],a=i.data.paramObj.title,o="poster";console.log("/longbing_card/staffs/pages/mine/upload/upload?src="+e+"&cardtype="+a+"&paramstatus="+o,"********1111"),wx.redirectTo({url:"/longbing_card/staffs/pages/mine/upload/upload?src="+e+"&cardtype="+a+"&paramstatus="+o+"&ratio=1.33"})}})},bindinput:function(t){var e=t.detail.value;this.setData({"paramObj.title":e})},toJump:function(t){var e=_xx_util2.default.getData(t).status;"toUpload"==e?this.chooseImage():"toDeleteImg"==e&&this.setData({"paramObj.tmpPath":"","paramObj.tmpImg":""})},formSubmit:function(t){var e=this,a=t.detail.formId,o=_xx_util2.default.getFromData(t).status;if(e.toSaveFormIds(a),"toSavePoster"==o){console.log(o);var i=t.detail.value.title,n=e.data.paramObj;if(!i)return _xx_util2.default.showModalText("","请填写海报标题"),!1;if(e.setData({"paramObj.title":i}),!n.tmpImg)return _xx_util2.default.showModalText("","请上传海报图片"),!1;_xx_util2.default.showLoading("海报上传中...",!0),e.toGetSavePoster()}},toSaveFormIds:function(t){app.util.request({url:"entry/wxapp/formid",cachetime:"30",method:"POST",data:{formId:t},success:function(t){t.data.errno},fail:function(t){}})}}); 
