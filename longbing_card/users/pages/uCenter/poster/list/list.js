var _xx_util=require("../../../../../resource/js/xx_util.js"),_xx_util2=_interopRequireDefault(_xx_util),_index=require("../../../../../resource/apis/index.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}var app=getApp();Page({data:{activeIndex:"100000101",refresh:!1,loading:!0,paramType:{to_uid:"",type:0,user_info:0},dataList:{page:1,total_page:"",post_img:[],refresh:!1,loading:!0}},onLoad:function(t){var e=this;wx.hideShareMenu(),getApp().getConfigInfo(!0,!1).then(function(){e.setData({"paramType.to_uid":wx.getStorageSync("userid"),"paramType.user_info":1,globalData:app.globalData},function(){e.getPosterType()})})},onReady:function(){},onShow:function(){this.onPullDownRefresh(),console.log("页面显示")},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){var t=this,e=t.data.activeIndex;console.log("dddddddddddddddddd   getPosterType",e),app.globalData.configInfo=!1,getApp().getConfigInfo(!0,!1).then(function(){t.setData({globalData:app.globalData},function(){t.setData({"dataList.refresh":!0,"dataList.page":1},function(){wx.showNavigationBarLoading(),"100000102"==e?t.toGetMyPoster():t.getPosterType()})})})},onReachBottom:function(){var t=this,e=t.data,a=e.activeIndex,o=e.dataList;o.page==o.total_page||o.loading||t.setData({"dataList.page":parseInt(o.page)+1,"dataList.loading":!0},function(){"100000102"==a?t.toGetMyPoster():t.getPosterType()})},onShareAppMessage:function(){},toDelPoster:function(t){var a=this,e=_xx_util2.default.getData(t),o=e.id,i=e.name,n=e.index;wx.showModal({title:"删除海报",content:"请确认是否要删除此海报  "+i,success:function(t){t.confirm&&(_xx_util2.default.showLoading(),_index.staffModel.toDelPoster({id:o}).then(function(t){if(_xx_util2.default.hideAll(),0==t.errno){_xx_util2.default.showSuccess("删除成功");var e=a.data.dataList.post_img;e.splice(n,1),a.setData({"dataList.post_img":e})}else _xx_util2.default.showToast("fail","删除失败")}))}})},toGetMyPoster:function(){var o=this,t=o.data,e=t.paramType,i=t.dataList;e.page=i.page,i.refresh||_xx_util2.default.showLoading(),_index.userModel.getMyPoster(e).then(function(t){_xx_util2.default.hideAll(),console.log("getMyPoster ==>",t.data);var e=i,a=t.data;i.refresh||(a.list=[].concat(_toConsumableArray(e.post_img),_toConsumableArray(a.list))),a.page=i.page,a.post_img=a.list,a.refresh=!1,a.loading=!1,o.setData({dataList:a})})},getPosterType:function(){var s=this,t=s.data,e=t.paramType,d=t.dataList,l=s.data.paramType.user_info;e.page=d.page,d.refresh||_xx_util2.default.showLoading(),_index.userModel.getPosterType(e).then(function(t){_xx_util2.default.hideAll(),console.log("getPosterType ==>",t.data);var e=d,a=t.data;d.refresh||(a.post_img=[].concat(_toConsumableArray(e.post_img),_toConsumableArray(a.post_img)));if(a.page=d.page,a.refresh=!1,a.loading=!1,1==l){var o=t.data,i=o.post_type_list,n=o.post_user,r=o.post_company;s.setData({post_type_list:i,post_user:n,post_company:r})}s.setData({dataList:a,userinfo:0})})},toJump:function(t){var e=this,a=t.currentTarget.dataset,o=a.status,i=a.index,n=a.categoryid;if("toTabClickMore"==o||"toTabClick"==o||"toTabClickMine"==o){var r=i,s=n;"toTabClickMore"==o&&(r="100000101",s=0),"toTabClickMine"==o&&(r="100000102",s="Mine"),console.log(r,"tmpIndex   tmpIndextmpIndextmpIndex"),e.setData({activeIndex:r,categoryid:n,scrollNav:"scrollNav"+s,"dataList.page":1,"dataList.post_img":[],"dataList.refresh":!1,"paramType.type":n,"paramType.user_info":0},function(){"toTabClickMine"==o?e.toGetMyPoster():e.getPosterType()})}else"toShare"==o?e.setData({currentPoster:i},function(){_xx_util2.default.goUrl(t)}):"toJumpUrl"==o&&_xx_util2.default.goUrl(t)},formSubmit:function(t){var e=t.detail.formId,a=(t.detail.target.dataset.index,t.detail.target.dataset.status);this.toSaveFormIds(e),console.log("toJump ==> ",a),app.util.goUrl(t,!0)},toSaveFormIds:function(t){app.util.request({url:"entry/wxapp/formid",cachetime:"30",method:"POST",data:{formId:t},success:function(t){t.data.errno},fail:function(t){}})}}); 
