var _xx_util=require("../../../resource/js/xx_util.js"),_xx_util2=_interopRequireDefault(_xx_util),_index=require("../../../resource/apis/index.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var app=getApp(),getAppGlobalData=require("../../../templates/copyright/copyright.js");Page({data:{showCheck:-1},onLoad:function(t){var r=this;app.util.showLoading(1),wx.hideShareMenu(),getApp().getConfigInfo(!0,!1).then(function(){var t=app.globalData,e=t.platform,o=t.configInfo.config,a=o.android_pay,i=o.ios_pay,n=!0;-1<e.indexOf("android")&&0==a&&(n=!1),-1<e.indexOf("ios")&&0==i&&(n=!1),r.setData({tmp_showPrice:n,globalData:app.globalData},function(){r.getUserInfo()})}),wx.hideLoading()},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){var t=this;getApp().getConfigInfo(!0,!1).then(function(){t.setData({globalData:app.globalData,refresh:!0},function(){wx.showNavigationBarLoading(),t.getUserInfo()})})},onReachBottom:function(){},onShareAppMessage:function(){},getUserInfo:function(){var e=this;app.util.request({url:"entry/wxapp/userinfo",cachetime:"30",method:"POST",data:{},success:function(t){console.log("userinfo ==>",t),t.data.errno||e.setData({userData:t.data.data})},fail:function(t){console.log("userinfo ==> fail ==> ",t)}})},toJump:function(t){var e=_xx_util2.default.getData(t).status;"toJumpUrl"==e&&_xx_util2.default.goUrl(t),"toCancel"==e&&this.setData({order_id:!1,showCheck:!1})},formSubmitCheck:function(t){var o=this,e=t.detail.formId,a=t.detail.value.pwd,i=o.data.order_id;if(!a)return _xx_util2.default.showFail("请输入核销密码！"),!1;wx.showModal({title:"",content:"请确认是否要核销此订单",success:function(t){t.confirm&&(_xx_util2.default.showLoading(),_index.staffModel.toCheckPassword({pwd:a,id:i}).then(function(t){if(_xx_util2.default.hideAll(),0==t.errno)_xx_util2.default.showSuccess("核销成功"),setTimeout(function(){o.setData({showCheck:!1})},2e3);else if(-1==t.errno){var e=t.message;"pwd error"==e&&(e="密码输入错误！"),"can not write off this order"==e&&(e="此单已核销！"),_xx_util2.default.showFail(e)}else _xx_util2.default.showToast("fail","核销失败")}))}}),o.toSaveFormIds(e)},formSubmit:function(t){var o=this,e=t.detail.formId,a=_xx_util2.default.getFromData(t),i=a.status;a.index;"toJumpUrl"==i&&_xx_util2.default.goUrl(t,!0),"toShowCheck"==i&&wx.scanCode({success:function(t){var e=JSON.parse(t.result).order_id;o.setData({order_id:e,showCheck:!0})}}),o.toSaveFormIds(e)},toSaveFormIds:function(t){app.util.request({url:"entry/wxapp/formid",cachetime:"30",method:"POST",data:{formId:t},success:function(t){t.data.errno},fail:function(t){}})}}); 
